<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Sales Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #1e90ff;
            --secondary-color: #2c3e50;
            --accent-color: #3498db;
            --background-dark: #121212;
            --text-light: #e0e0e0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: var(--background-dark);
            color: var(--text-light);
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .sidebar {
            width: 80px;
            background-color: #1f2937;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            transition: width 0.3s;
        }

        .sidebar:hover {
            width: 250px;
        }

        .sidebar-btn {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 15px;
            color: var(--text-light);
            text-decoration: none;
            transition: background 0.3s;
        }

        .sidebar-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .sidebar-btn i {
            margin-right: 15px;
            font-size: 20px;
        }

        .main-content {
            flex-grow: 1;
            padding: 20px;
            background-color: #1e2432;
        }

        .cyber-card {
            background-color: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        input, select {
            background-color: #34495e;
            border: none;
            color: var(--text-light);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .cyber-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
            margin-bottom: 10px;
        }

        .cyber-btn:hover {
            transform: scale(1.05);
        }

        #salesTable {
            width: 100%;
            border-collapse: collapse;
            background-color: #2c3e50;
        }

        #salesTable th {
            background-color: #34495e;
            color: var(--text-light);
            padding: 10px;
            text-align: left;
        }

        #salesTable td {
            padding: 10px;
            border-bottom: 1px solid #34495e;
        }

        .receipt-preview {
            background-color: white;
            color: black;
            padding: 20px;
            max-width: 400px;
            margin: 20px auto;
            position: relative;
        }

        .download-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-top: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .download-btn:hover {
            background-color: #45a049;
        }

        #watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 50px;
            color: rgba(0,0,0,0.1);
            z-index: 1;
            pointer-events: none;
            white-space: nowrap;
        }

        .currency-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .currency-toggle button {
            margin: 0 5px;
            padding: 5px 10px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .currency-toggle button.active {
            background-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <a href="#" class="sidebar-btn" data-section="dashboard">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
        </a>
        <a href="#" class="sidebar-btn" data-section="receipt">
            <i class="fas fa-receipt"></i>
            <span>Generate Receipt</span>
        </a>
        <a href="#" class="sidebar-btn" data-section="sales">
            <i class="fas fa-shopping-cart"></i>
            <span>View Sales</span>
        </a>
        <a href="#" class="sidebar-btn" data-section="profit">
            <i class="fas fa-dollar-sign"></i>
            <span>Profit Calculator</span>
        </a>
    </div>

    <div class="main-content">
        <div id="dashboard" class="cyber-card">
            <h2>Sales Dashboard</h2>
            <div id="dashboardStats">
                <p>Total Sales: <span id="totalSalesAmount">$0</span></p>
                <p>Total Products Sold: <span id="totalProductsSold">0</span></p>
            </div>
        </div>

        <div id="receipt" class="cyber-card" style="display:none;">
            <h2>Generate Receipt</h2>
            
            <div class="currency-toggle">
                <button onclick="setCurrency('USD')" class="active">USD ($)</button>
                <button onclick="setCurrency('KES')">KES (Ksh)</button>
            </div>

            <div class="input-group">
                <input type="text" id="companyName" placeholder="Company Name" required>
                <input type="text" id="productName" placeholder="Product Name" required>
                <input type="number" id="quantity" placeholder="Quantity" required>
                <input type="number" id="unitPrice" placeholder="Unit Price" required>
                <button class="cyber-btn" onclick="generateReceipt()">Generate Receipt</button>
            </div>
            <div id="receiptPreview" class="receipt-preview">
                <div id="watermark"></div>
                <div id="receiptContent"></div>
                <button class="download-btn" onclick="downloadReceiptAsPNG()" style="display:none;">
                    Download Receipt
                </button>
            </div>
        </div>

        <div id="sales" class="cyber-card" style="display:none;">
            <h2>Sales History</h2>
            <table id="salesTable" style="background-color: red;">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>Total Sales</th>
                    </tr>
                </thead>
                <tbody id="salesTableBody"></tbody>
            </table>
        </div>

        <div id="profit" class="cyber-card" style="display:none;">
            <h2>Profit & Loss Calculator</h2>
            <div class="input-group">
                <input type="text" id="profitProductName" placeholder="Product Name">
                <input type="number" id="buyingPrice" placeholder="Buying Price">
                <input type="number" id="sellingPrice" placeholder="Selling Price">
                <input type="number" id="incurredCost" placeholder="Incurred Cost">
                <button class="cyber-btn" onclick="calculateProfit()">Calculate Profit</button>
            </div>
            <div id="profitResult"></div>
        </div>
    </div>

    <script>
        // Global Variables
        let salesData = [];
        let currentCurrency = 'USD';
        const exchangeRate = 160; // 1 USD = 160 KES

        // Section Navigation
        document.querySelectorAll('.sidebar-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const sectionId = this.getAttribute('data-section');
                document.querySelectorAll('.main-content > div').forEach(section => {
                    section.style.display = 'none';
                });
                document.getElementById(sectionId).style.display = 'block';
            });
        });

        function setCurrency(currency) {
            currentCurrency = currency;
            document.querySelectorAll('.currency-toggle button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function formatAmount(amount) {
            if (currentCurrency === 'USD') {
                return `$${amount.toFixed(2)}`;
            } else {
                return `Ksh ${(amount * exchangeRate).toFixed(2)}`;
            }
        }

        function generateReceipt() {
            const companyName = document.getElementById('companyName').value;
            const productName = document.getElementById('productName').value;
            const quantity = parseFloat(document.getElementById('quantity').value);
            const unitPrice = parseFloat(document.getElementById('unitPrice').value);
            const totalSales = quantity * unitPrice;
            const currentDate = new Date().toLocaleDateString();

            // Validate inputs
            if (!companyName || !productName || !quantity || !unitPrice) {
                alert('Please fill in all fields');
                return;
            }

            // Update watermark
            document.getElementById('watermark').textContent = companyName;

            const receiptHtml = `
                <h3>${companyName} Receipt</h3>
                <p>Product: ${productName}</p>
                <p>Quantity: ${quantity}</p>
                <p>Unit Price: ${formatAmount(unitPrice)}</p>
                <p>Total: ${formatAmount(totalSales)}</p>
                <p>Date: ${currentDate}</p>
            `;

            // Update receipt content
            document.getElementById('receiptContent').innerHTML = receiptHtml;

            // Show download button
            document.querySelector('.download-btn').style.display = 'block';

            // Store sales data
            salesData.push({
                productName,
                quantity,
                totalSales
            });

            updateSalesTable();
            updateDashboard();
        }

        function updateSalesTable() {
            const tableBody = document.getElementById('salesTableBody');
            tableBody.innerHTML = '';
            salesData.forEach(sale => {
                const row = `
                    <tr>
                        <td>${sale.productName}</td>
                        <td>${sale.quantity}</td>
                        <td>${formatAmount(sale.totalSales)}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        function updateDashboard() {
            const totalSales = salesData.reduce((sum, sale) => sum + sale.totalSales, 0);
            const totalProducts = salesData.reduce((sum, sale) => sum + sale.quantity, 0);

            document.getElementById('totalSalesAmount').textContent = formatAmount(totalSales);
            document.getElementById('totalProductsSold').textContent = totalProducts;
        }

        function downloadReceiptAsPNG() {
            // Use html2canvas to convert receipt to image
            const receiptElement = document.getElementById('receiptPreview');
            
            html2canvas(receiptElement, {
                scale: 2, // Increases resolution
                backgroundColor: 'white' // Ensures white background
            }).then(canvas => {
                // Create a link element to download the image
                const link = document.createElement('a');
                link.download = `receipt_${new Date().toISOString().slice(0,10)}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        function calculateProfit() {
            const productName = document.getElementById('profitProductName').value;
            const buyingPrice = parseFloat(document.getElementById('buyingPrice').value);
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value);
            const incurredCost = parseFloat(document.getElementById('incurredCost').value);

            // Validate inputs
            if (!productName || !buyingPrice || !sellingPrice || !incurredCost) {
                alert('Please fill in all fields');
                return;
            }

            const profit = (sellingPrice - buyingPrice - incurredCost);
            const profitStatus = profit > 0 ? 'Profit' : 'Loss';

            const resultHtml = `
                <h3>Profit Analysis for ${productName}</h3>
                <p>Buying Price: ${formatAmount(buyingPrice)}</p>
                <p>Selling Price: ${formatAmount(sellingPrice)}</p>
                <p>Incurred Cost: ${formatAmount(incurredCost)}</p>
                <p>Total ${profitStatus}: ${formatAmount(Math.abs(profit))}</p>
            `;

            document.getElementById('profitResult').innerHTML = resultHtml;
        }
    </script>
</body>
</html>